---
import { Icon } from "@src/components/Icons";
import { t as tbase } from "@src/lib/translations";
import _ from "lodash";
import LanguageSelector from "./LanguageSelector.astro";
import { removeTrailingSlash } from "@src/lib/urlhelpers";

const pathName = removeTrailingSlash(Astro.url.pathname);
const basePath = "/" + pathName.split("/")[1];

const { alternativeLanguageMap, locale } = Astro.props;

const t = (key) => tbase(key, locale);

const navItems = [
    {
        name: t("navigation").home,
        isCurrent:
            basePath == pathName && new RegExp(locale + "+$").test(pathName),
        href: `/${locale}`,
    },
    {
        name: t("navigation").about,
        isCurrent: new RegExp(locale + "/about").test(pathName),
        href: `/${locale}/about`,
    },
    {
        name: t("navigation").cv,
        isCurrent: new RegExp(locale + "/cv").test(pathName),
        href: `/${locale}/cv`,
    },
    {
        name: t("navigation").posts,
        isCurrent: new RegExp("posts/" + locale + "/*").test(pathName),
        href: "/posts/" + locale,
    },
];
---

<header class="header" role="banner">
    <nav role="navigation" tabindex="-1">
        <div
            class="z-40 bg-bg relative sm:static w-full sm:p-4 flex flex-col justify-between select-none"
        >
            <input
                type="checkbox"
                checked
                id="nav-toggle"
                class="hidden"
                aria-controls="navigationitems"
            />
            <!-- Logo and hamburger menu on mobile -->
            <div
                class="nav-shadow-togglable flex sm:w-min w-full p-4 bg-bgel sm:hidden shadow-2xl sm:shadow-none transition-all"
            >
                <div class="flex">
                    <label
                        for="nav-toggle"
                        aria-label="Toggle navigation menu"
                        role="button"
                        tabindex="0"
                    >
                        <Icon name="menu" class="w-10 h-10 self-center" />
                    </label>
                    <a class="flex ml-4" href={"/"} aria-label="home">
                        <Icon
                            name="logo"
                            class="w-10 h-10 self-center"
                            aria-hidden="true"
                            optimize={false}
                        />
                    </a>
                </div>
            </div>
            <!-- Navigation items -->
            <div class="nav-items-wrapper">
                <nav
                    id="navigationitems"
                    class="-z-10 sm:z-10 absolute sm:static top-full left-0 p-4 m-[inherit] sm:p-0 sm:m-0 w-full transition-transform motion-reduce:transition-none sm:max-h-full sm:flex sm:bg-bg bg-bgel shadow-2xl sm:shadow-none flex-col sm:flex-row justify-between sm:translate-y-0 transform-gpu origin-top"
                >
                    <ul class="flex flex-col sm:flex-row">
                        <li class="sm:flex self-center mr-2 hidden">
                            <Icon
                                name="logo"
                                class="w-10 h-10"
                                aria-hidden="true"
                                optimize={false}
                            />
                        </li>
                        {navItems.map((item) => {
                            return (
                                <li
                                    class={`${
                                        item.isCurrent
                                            ? "bg-primary text-white dark:text-black"
                                            : "text-primary"
                                    } mr-1 flex w-full rounded-sm font-medium sm:w-max`}
                                >
                                    <a
                                        class="block w-full py-2 px-4"
                                        href={item.href}
                                    >
                                        {item.name}
                                    </a>
                                </li>
                            );
                        })}
                    </ul>
                </nav>
                <label
                    for="nav-toggle"
                    tabindex="0"
                    role="button"
                    aria-label="Close navigation"
                    class="-z-20 nav-hide h-screen w-screen bg-bg/80 transition-colors fixed top-0 sm:hidden"
                >
                </label>
            </div>
        </div>
    </nav>
    {!_.isEmpty(alternativeLanguageMap) && alternativeLanguageMap != null && (
        <LanguageSelector {alternativeLanguageMap} />
    )}
</header>
