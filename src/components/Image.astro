---
// Based on https://github.com/Princesseuh/astro-eleventy-img/
import { getPicture } from "@astrojs/image";

interface Props {
    src: Promise<any>;
    alt: string;
    caption?: string;
    widths?: number[];
    sizes?: number[];
    classes?: string;
}

const {
    src,
    alt,
    caption,
    widths = [300, 600],
    sizes = [300, 600],
    classes = "",
} = Astro.props as Props;

const { image, sources } = await getPicture({
    aspectRatio: 0,
    src,
    widths,
    formats: ["avif", "webp", "png"],
});
---

<figure>
    <picture>
        {sources.map((attrs) => <source {...attrs} {sizes} />)}
        <img
            {...image}
            class={classes}
            loading="lazy"
            decoding="async"
            alt={alt}
            onload="this.style.backgroundImage='none'"
        />
    </picture>
    {caption && <figcaption>{caption}</figcaption>}
</figure>
